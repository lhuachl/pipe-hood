# üéâ pipehood v1.1.0 - CRUD Operations ¬°Implementado!

## ‚ú® Nuevas Funcionalidades

### ‚úÖ INSERT (CREATE)
```typescript
const newUser = await factory.create()
  .table('usuarios')
  .insert({ 
    nombre: 'Juan',
    email: 'juan@example.com',
    activo: true 
  })
  .execute();
```

### ‚úÖ UPDATE
```typescript
const updated = await factory.create()
  .table('usuarios')
  .update({ 
    nombre: 'Mar√≠a',
    activo: false 
  })
  .whereEq('id', 1)
  .execute();
```

### ‚úÖ DELETE (with Safety Check)
```typescript
const deleted = await factory.create()
  .table('usuarios')
  .whereEq('id', 1)
  .delete()
  .execute();

// ‚ö†Ô∏è DELETE sin WHERE throws error:
factory.create().table('usuarios').delete()
  // ‚ùå Error: DELETE requiere al menos una condici√≥n WHERE (seguridad)
```

### ‚úÖ SELECT (Ya Exist√≠a)
```typescript
const usuarios = await factory.create()
  .table('usuarios')
  .select('id', 'nombre', 'email')
  .whereEq('activo', true)
  .execute();
```

---

## üîß Cambios T√©cnicos

### QueryState Actualizado
```typescript
interface QueryState {
  table: string;
  // SELECT
  selects: string[];
  // INSERT
  insertValues?: Record<string, unknown>;
  // UPDATE
  updateValues?: Record<string, unknown>;
  // WHERE
  where: SQLFragment[];
  // ORDER BY
  orderBy: Array<{ column: string; direction: 'asc' | 'desc' }>;
  // LIMIT / OFFSET
  limit?: number;
  offset?: number;
  // Query Type
  type: 'SELECT' | 'INSERT' | 'UPDATE' | 'DELETE';
}
```

### PostgresCompiler Mejorado
- `compileSelect()` - SELECT queries
- `compileInsert()` - INSERT queries
- `compileUpdate()` - UPDATE queries
- `compileDelete()` - DELETE queries

### Nuevos M√©todos en QueryBuilder
- `.insert(values)` - Define valores a insertar
- `.update(values)` - Define valores a actualizar
- `.delete()` - Marca query como DELETE

---

## üìä Operaciones Soportadas Ahora

| Operaci√≥n | ¬øSoportado? | M√©todo |
|-----------|-----------|--------|
| SELECT | ‚úÖ S√≠ | `.select(...cols)` |
| INSERT | ‚úÖ S√≠ | `.insert(values)` |
| UPDATE | ‚úÖ S√≠ | `.update(values).where(...)` |
| DELETE | ‚úÖ S√≠ | `.where(...).delete()` |
| WHERE | ‚úÖ S√≠ | `.whereEq()`, `.whereRaw()`, `.whereIn()` |
| ORDER BY | ‚úÖ S√≠ | `.orderBy(col, dir)` |
| LIMIT | ‚úÖ S√≠ | `.limit(n)` |
| OFFSET | ‚úÖ S√≠ | `.offset(n)` |
| JOIN | ‚ùå No | (Planificado v1.2) |
| GROUP BY | ‚ùå No | (Planificado v1.2) |
| Transactions | ‚ùå No | (Planificado v2.0) |

---

## üöÄ Ejemplo Completo

```typescript
import { QueryBuilderFactory, PostgresCompiler, SupabaseExecutor } from 'pipehood';
import postgres from 'postgres';

const db = postgres({ /* config */ });
const factory = new QueryBuilderFactory(
  new PostgresCompiler(),
  new SupabaseExecutor(db)
);

// CREATE
const newUser = await factory.create()
  .table('usuarios')
  .insert({ nombre: 'Carlos', email: 'carlos@example.com' })
  .execute();

// READ
const users = await factory.create()
  .table('usuarios')
  .select('id', 'nombre')
  .execute();

// UPDATE
await factory.create()
  .table('usuarios')
  .update({ nombre: 'Carlos Actualizado' })
  .whereEq('id', 1)
  .execute();

// DELETE
await factory.create()
  .table('usuarios')
  .whereEq('id', 1)
  .delete()
  .execute();
```

---

## üìù Caracter√≠sticas de Seguridad

### 1. **DELETE Seguro**
```typescript
// ‚ùå BLOQUEADO - Previene eliminaci√≥n accidental
factory.create().table('usuarios').delete().execute()
// Error: DELETE requiere al menos una condici√≥n WHERE

// ‚úÖ PERMITIDO - Con WHERE expl√≠cito
factory.create().table('usuarios').whereEq('id', 1).delete().execute()
```

### 2. **SQL Parametrizado**
```typescript
// Todos los valores est√°n parametrizados (protecci√≥n contra SQL injection)
INSERT INTO usuarios (nombre, email) VALUES ($1, $2)  -- Seguro
UPDATE usuarios SET nombre = $1 WHERE id = $2         -- Seguro
DELETE FROM usuarios WHERE id = $1                    -- Seguro
```

### 3. **Validaci√≥n de Entrada**
```typescript
// INSERT sin valores ‚Üí Error
factory.create().table('usuarios').insert({}).execute()
// Error: INSERT requiere valores

// UPDATE sin WHERE ‚Üí Error
factory.create().table('usuarios').update({ name: 'x' }).execute()
// Error: UPDATE requiere al menos una condici√≥n WHERE
```

---

## üì¶ Versi√≥n

**pipehood@1.1.0**
- ‚úÖ SELECT completo
- ‚úÖ INSERT completo
- ‚úÖ UPDATE completo
- ‚úÖ DELETE completo con seguridad

---

## üéì Ejemplos

Ver ejemplos completos en:
```bash
npm run example:crud
```

Archivo: `examples/07-crud-operations.ts`

---

## üîÑ Cambios en package.json

```json
{
  "version": "1.1.0",
  "scripts": {
    "example:crud": "tsx examples/07-crud-operations.ts"
  }
}
```

---

## ‚ö° Resumen

De ahora en adelante, `pipehood` no es solo un Query Builder, es:

```
Query Builder + CRUD Operations
    ‚Üì
Herramienta Completa para:
‚úÖ Leer datos (SELECT)
‚úÖ Crear datos (INSERT)
‚úÖ Actualizar datos (UPDATE)
‚úÖ Eliminar datos (DELETE)
```

Mantiene:
‚úÖ Arquitectura limpia
‚úÖ Inyecci√≥n de dependencias
‚úÖ API fluida
‚úÖ Seguridad (SQL parametrizado)
‚úÖ Tama√±o optimizado (~15-18 kB estimado)

---

## üö¢ Pr√≥ximas Versiones Planificadas

- **v1.2.0**: JOIN support (INNER, LEFT, RIGHT, FULL)
- **v1.3.0**: GROUP BY / HAVING
- **v2.0.0**: Transactions y Batch operations
- **v2.1.0**: Relationships y lazy loading

---

**¬°Listo para publicar en npm!** üéâ
